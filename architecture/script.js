let munObjData = {
	"Муниципальное образование «Боброво-Лявленское»":{
		"Филиал ГБУЗ «Приморская ЦРБ» ФАП «Кузьмино»":{
			"circles":[[64.384122, 40.952221]],
			"link":"objects\\Боброво_Лявленское\\1ФАП Кузьмино.docx"
		},
		"ГБСУ АО «Трепузовский психоневрологический интернат»":{
			"circles":[[64.364531, 41.057263]],
			"coord":[[64.364552, 41.057315], [64.364229, 41.055964], [64.363505, 41.053916], [64.362855, 41.055407], [64.361712, 41.058993], [64.361831, 41.059583], [64.362407, 41.060259], [64.362903, 41.059916], [64.363384, 41.059256], [64.363326, 41.059004]],
			"link":"objects\\Боброво_Лявленское\\2Трепузовский.docx"
		},
		"Филиал ГБУЗ «Приморская ЦРБ» ФАП «Лявля»":{
			"circles":[[64.377382, 41.023102]],
			"link":"objects\\Боброво_Лявленское\\3 ФАП Косково.docx"
		},
		"Филиал ГБУЗ «Приморская ЦРБ» ФАП «Лявля»":{
			"circles":[[64.377382, 41.023102]],
			"link":"objects\\Боброво_Лявленское\\3 ФАП Лявля.docx"
		},
		"ГБУЗ АО Приморская ЦРБ «Врачебная амбулатория Боброво»":{
			"circles":[[64.356271, 41.152864]],
			"link":"objects\\Боброво_Лявленское\\4 Амбулатория Боброво.docx"
		},
		"МБОУ «Бобровская СОШ» филиал Лявленская начальная школа-детский сад":{
			"circles":[[64.385344, 41.028002]],
			"coord":[[64.385344, 41.028002], [64.385389, 41.028683], [64.386215, 41.028863], [64.386250, 41.028579], [64.386266, 41.028278], [64.385950, 41.027171]],
			"link":"objects\\Боброво_Лявленское+\\5 Детский сад Лявля.docx"
		},
		"Хоккейная площадка":{
			"circles":[[64.355425, 41.153505]],
			"coord":[[64.384470, 41.023174], [64.355077, 41.153368], [64.355035, 41.153438], [64.354998, 41.153864], [64.355021, 41.153952], [64.355418, 41.154124], [64.355467, 41.154030], [64.355508, 41.153593]],
			"link":"objects\\Боброво_Лявленское\\8 Хоккейная площадка Боброво.docx"
		},
		"Волебольная площадка":{
			"circles":[[64.384481, 41.023227], [64.384530, 41.023296]],
			"coord":[[64.384463, 41.023192], [64.384466, 41.023294], [64.384245, 41.023669], [64.384190, 41.023219]],
			"link":"objects\\Боброво_Лявленское\\10 Волебольная площадка у ДК д. Новинки.docx"
		},
		"Тренажерный зал":{
			"circles":[[64.384530, 41.023296]],
			"link":"objects\\Боброво_Лявленское\\11 Тренажерный зал в ДК д. Новинки.docx"
		},
		"МБОУ \"Бобровская СШ\"":{
			"circles":[[64.355441, 41.159274], [64.355318, 41.159295], [64.355028, 41.159322], [64.354367, 41.158974], [64.355004, 41.160749]],
			"coord":[[64.355655, 41.161033], [64.354135, 41.160288], [64.354279, 41.158925], [64.355021, 41.159295], [64.355744, 41.159236]],
			"link":"objects\\Боброво_Лявленское+\\Бобровская СШ.docx"
		}
	},
	"Муниципальное образование «Заостровское»":{
		"Филиал ГБУЗ «Приморская ЦРБ»":{
			"circles":[[64.480806, 40.506659], [64.480242, 40.507121]],
			"coord":[[64.480199, 40.507062], [64.480002, 40.505111], [64.480169, 40.505005], [64.480266, 40.505077], [64.480885, 40.504774], [64.480928, 40.505272], [64.480810, 40.505369], [64.480937, 40.506404], [64.480880, 40.506616], [64.480261, 40.507134]],
			"link":"objects\\Заостровское\\1Заостровская больница.docx"
		},
		"Филиал ГБУЗ «Приморская ЦРБ» ФАП «Луговой»":{
			"circles":[[64.510236, 40.433643]],
			"link":"objects\\Заостровское\\2 ФАП п. Луговой.docx"
		},
		"МБОУ «Заостровская СШ» структурное подразделение «Детский сад с. Заостровье»":{
			"circles":[[64.482514, 40.506841]],
			"coord":[[64.482523, 40.506733], [64.482432, 40.505303], [64.482410, 40.505258], [64.481898, 40.505480], [64.481809, 40.505641], [64.481897, 40.507116], [64.482476, 40.506961]],
			"link":"objects\\Заостровское\\3 Детский сад Заостровье.docx"
		},
		"МБОУ «Заостровская СШ» (здание начальной школы)":{
			"circles":[[64.481378, 40.50937], [64.481388, 40.507445]],
			"coord":[[64.481661, 40.507544], [64.481131, 40.507211], [64.480902, 40.509133], [64.481435, 40.509456]],
			"link":"objects\\Заостровское\\4 Начальная школа. Заостровье.docx"
		},
		"МБОУ «Заостровская СШ»":{
			"circles":[[64.480828, 40.509985], [64.481613, 40.511350], [64.480118, 40.513856]],
			"coord":[[64.479928, 40.514234], [64.481619, 40.511373], [64.481070, 40.510182], [64.480652, 40.509839], [64.479365, 40.512228]],
			"link":"objects\\Заостровское\\5 Школа в д. Рикасово.docx"
		},
		"Тренажерный зал":{
			"circles":[[64.484346, 40.506686]],
			"link":"objects\\Заостровское\\7 Тренажерный зал. Заостровье.docx"
		}
	},
	"Муниципальное образование «Катунинское»":{
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Катунинское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Катунинское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Катунинское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Катунинское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Катунинское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Катунинское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Катунинское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Катунинское\\.docx"
		}
	},
	"Муниципальное образование «Лисестровское»":{	
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Лисестровское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Лисестровское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Лисестровское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Лисестровское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Лисестровское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Лисестровское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Лисестровское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Лисестровское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Лисестровское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Лисестровское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Лисестровское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Лисестровское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Лисестровское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Лисестровское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Лисестровское\\.docx"
		}
	},
	"Муниципальное образование «Островное»":{

	},
	"Муниципальное образование «Пертоминское»":{

	},
	"Муниципальное образование «Приморское»":{
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Приморское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Приморское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Приморское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Приморское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Приморское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Приморское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Приморское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Приморское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Приморское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Приморское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Приморское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Приморское\\.docx"
		},
		"":{
			"circles":[[]],
			"coord":[[]],
			"link":"objects\\Приморское\\.docx"
		}
	},
	"Муниципальное образование «Сельское поселение «Соловецкое»":{

	},
	"Муниципальное образование «Талажское»":{

	},
	"Муниципальное образование «Уемское»":{
		"ГБУЗ АО «Приморская ЦРБ» Уемская районная больница":{
			"circles":[[64.473565, 40.864479]],
			"link":"objects\\Уемское\\1 Уемская больница.docx"
		},
		"МБОУ «Уемская СШ»":{
			"circles":[[64.478826, 40.842030], [64.478238, 40.843591]],
			"coord":[[64.479041, 40.840856], [64.478520, 40.840166], [64.478226, 40.840209], [64.477522, 40.842922], [64.478358, 40.843720]],
			"link":"objects\\Уемское\\2 Уемская школа.docx"
		},
		"Филиал «Детская школа искусств п. Уемский» МБУ ДО «Приморская ДШИ»":{
			"circles":[[64.478826, 40.842030], [64.478238, 40.843591]],
			"coord":[[64.479041, 40.840856], [64.478520, 40.840166], [64.478226, 40.840209], [64.477522, 40.842922], [64.478358, 40.843720]],
			"link":"objects\\Уемское\\3 филиал Уемский ДШИ.docx"
		},
		"ГБСУ АО «Приморский СРЦН «Радуга»":{
			"circles":[[64.471922, 40.872014]],
			"coord":[[64.472672, 40.872432], [64.472184, 40.871381], [64.471665, 40.872652], [64.472154, 40.873698]],
			"link":"objects\\Уемское\\4 Центр Радуга.docx"
		},
		"Футбольная площадка":{
			"circles":[[64.474802, 40.863905]],
			"coord":[[64.475165, 40.863992], [64.474842, 40.863527], [64.474765, 40.863832], [64.475083, 40.864307]],
			"link":"objects\\Уемское\\5 Футбольная площадка Уемское.docx"
		},
		"МБОУ «Уемская СШ» Структурное подразделение «Детский сад п. Уемский»":{
			"circles":[[64.473155, 40.868829]],
			"coord":[[64.473766, 40.869864], [64.473766, 40.869864], [64.473176, 40.868780], [64.472884, 40.869478], [64.472967, 40.869633], [64.472861, 40.869864], [64.472590, 40.869671], [64.472384, 40.870159], [64.473007, 40.871554]],
			"link":"objects\\Уемское\\6 Детский сад Уемский.docx"
		},
		"Лыжный стадион им. В. С. Кузина":{
			"circles":[[64.462176, 40.943002]],
			"coord":[[64.462452, 40.943326], [64.462317, 40.943203], [64.462198, 40.942991], [64.462181, 40.942945], [64.462051, 40.941510], [64.460345, 40.939780], [64.459727, 40.944538], [64.460838, 40.949355], [64.462542, 40.949645]],
			"link":"objects\\Уемское\\7 Стадион. М. Корелы.docx"
		}
	}
}

ymaps.ready(init); 

var mapCircle,
	circleCollection = {};

function init() { 
	yMap = new ymaps.Map("map", { 
		center: [64.543235, 40.537195], 
		zoom: 13 
	});

	circleCollection = new ymaps.GeoObjectCollection({}, {
    	fillColor: "#FF000025", 
	  	strokeColor: "#FF0000", 
	   	strokeWidth: 2 
	});
}


function createSelect(selectElement, objectData, addData = false) { 
	selectElement.html('');
	Object.keys(objectData).forEach(function (item){
		selectElement.append($('<li>').text(item));
	});
}

function closeList(listEl = $('.selectElement ul'), currentEl = $('.valueText')) { 
	currentEl.children('img').css('transform', 'rotate(0)');
	listEl.css('display', 'none');
	currentEl.removeClass('active');
}

function openList(listEl, currentEl) { 
	currentEl.children('img').css('transform', 'rotate(180deg)');
	listEl.css('display', 'block');
	currentEl.addClass('active');
}

createSelect($('#munForm ul'), munObjData);

$('.valueText').on('click', function() { 
	closeList();
	let listEl = $(this).parent().children('ul')

	if ($(this).hasClass('active')) 
		closeList(listEl, $(this));
	else
		openList(listEl, $(this));
});

$('#munForm').on('click', 'li', function() { 
	createSelect($('#munObj ul'), munObjData[$(this).text()]);
	$('#munForm .valueText').children('span').text($(this).text());
	closeList();
});

$('#munObj').on('click', 'li', function() { 	
	circleCollection = new ymaps.GeoObjectCollection({}, {
    	fillColor: "#FF000025", 
	  	strokeColor: "#FF0000", 
	   	strokeWidth: 2 
	});

	$('#munObj .valueText').children('span').text($(this).text());
	closeList();

	$('#download').removeClass('disabled');
	$('#download').attr('href', munObjData[$('#munForm .valueText span').text()][$('#munObj .valueText span').text()].link);

	yMap.geoObjects.removeAll();

	if (munObjData[$('#munForm .valueText span').text()][$('#munObj .valueText span').text()].coord == undefined) {
		munObjData[$('#munForm .valueText span').text()][$('#munObj .valueText span').text()].circles.forEach(function(item) {
			circleCollection.add(new ymaps.Circle([item, 30]));
		});		


	} else {
		munObjData[$('#munForm .valueText span').text()][$('#munObj .valueText span').text()].circles.forEach(function(item) {
			circleCollection.add(new ymaps.Circle([item, 30]));
		});
		circleCollection.add(new ymaps.Polygon([munObjData[$('#munForm .valueText span').text()][$('#munObj .valueText span').text()].coord]));
	}
	yMap.geoObjects.add(circleCollection);
	yMap.setBounds(circleCollection.getBounds(), {
		checkZoomRange:true
	}).then(function() {
		if (map.getZoom() > 10)
			map.setZoom(10);
	});
});

//Матан, геодезия, геометрия
//Оказалось, что в соотвествуии с действующим законодательством следубщий код не нужен. Но лучше оставлю.
/*
function resizePoly(arrCoord) { 
	let lineCoordArray = [], bigPolyCoordLine = [], angleObj = [];

	arrCoord.forEach(function (item, i) {
		lineCoordArray.push(
			(i < arrCoord.length - 1) ? 
			[item, arrCoord[i + 1]] : 
			[item, arrCoord[0]]
		);
	});

	lineCoordArray.forEach(function(item) {
		angleObj.push({
			angle: getDirection(item, 30)[0],
			direction: getDirection(item, 30)[1],
			points: item
		});
	});
	
	angleObj.forEach(function(item, i) {
		if (i == angleObj.length - 1) {
			bigPolyCoordLine = bigPolyCoordLine.concat(roundAngle(item.points[1], item.direction, angleObj[0].direction, item.angle, angleObj[0].angle));
		} else {
			bigPolyCoordLine = bigPolyCoordLine.concat(roundAngle(item.points[1], item.direction, angleObj[i + 1].direction, item.angle, angleObj[i + 1].angle));
		}
	});

	bigPolyCoordLine = crossingLine(bigPolyCoordLine);

	mapPoly.geometry.setCoordinates([bigPolyCoordLine]);
}

function crossingLine(bigPolyCoordLine, i = 0) {
	for (i = 0; i < bigPolyCoordLine.length - 1; i++) {
		let x1 = Number(bigPolyCoordLine[i][0]),
			y1 = Number(bigPolyCoordLine[i][1]),
			x2 = Number(bigPolyCoordLine[i + 1][0]),
			y2 = Number(bigPolyCoordLine[i + 1][1]);

		for (let j = i + 2; j < bigPolyCoordLine.length - 1; j++) {
			let x3 = Number(bigPolyCoordLine[j][0]),
				y3 = Number(bigPolyCoordLine[j][1]),
				x4 = Number(bigPolyCoordLine[j + 1][0]),
				y4 = Number(bigPolyCoordLine[j + 1][1]);

			let d = ((x1 - x2) * (y4 - y3)) - ((y1 - y2) * (x4 - x3)),
				da = (((x1 - x3) * (y4 - y3)) - ((y1 - y3) * (x4 - x3))),
				db = (((x1 - x2) * (y1 - y3)) - ((y1 - y2) * (x1 - x3))),
				ta = da / d,
				tb = db / d,
				x, y;

			if (ta >= 0 && ta <= 1 && tb >= 0 && tb <= 1) {
				x = x1 + (ta * (x2 - x1));
				y = y1 + (ta * (y2 - y1));

				bigPolyCoordLine.splice(i, j - i + 1);
				bigPolyCoordLine.splice(i, 0, [x, y])

				crossingLine(bigPolyCoordLine, i)
			}
		}
	}
	return bigPolyCoordLine;
}

function getCenterLinePoint(twoPointsArray) {
	return [((twoPointsArray[0][0] + twoPointsArray[1][0]) / 2), ((twoPointsArray[0][1] + twoPointsArray[1][1]) / 2)];
}

function getAngle(twoPointArray) {
	let centerPoint, endPoint;

	if (twoPointArray[0][1] < twoPointArray[1][1]) {
		centerPoint = {
			x: twoPointArray[0][0],
			y: twoPointArray[0][1]
		}

		endPoint = {
			x: twoPointArray[1][0],
			y: twoPointArray[1][1]
		}
	} else {
		centerPoint = {
			x: twoPointArray[1][0],
			y: twoPointArray[1][1]
		}

		endPoint = {
			x: twoPointArray[0][0],
			y: twoPointArray[0][1]
		}
	}

	let distanceX = ymaps.coordSystem.geo.getDistance([centerPoint.x, centerPoint.y], [endPoint.x, centerPoint.y]),
		distanceY = ymaps.coordSystem.geo.getDistance([centerPoint.x, centerPoint.y], [centerPoint.x, endPoint.y]);

	if ((centerPoint.x < endPoint.x) && (centerPoint.y < endPoint.y))
		return Math.atan2(distanceY, distanceX) + (Math.PI / 2);

	if ((centerPoint.x > endPoint.x) && (centerPoint.y < endPoint.y))
		return (Math.PI / 2) - Math.atan2(distanceY, distanceX);
}

function getDirection(item, distance) {
	let centerLinePoint = getCenterLinePoint(item),
		direction = getAngle(item);

	if (mapPoly.geometry.contains(ymaps.coordSystem.geo.solveDirectProblem(centerLinePoint, [Math.cos(direction), Math.sin(direction)], 1).endPoint))
		return [direction, -distance];
	else
		return [direction, distance];
}

function roundAngle(centerPoint, directionStart, directionEnd, angleStart, angleEnd) {
	let roundPointsArray = [];

	if (directionStart == directionEnd) {
		for (let i = angleStart; i > angleEnd; i -= (Math.PI / 45)) {
			roundPointsArray.push(ymaps.coordSystem.geo.solveDirectProblem(centerPoint, [Math.cos(i), Math.sin(i)], directionStart).endPoint);
		}
	} else {
		for (let i = angleStart; i > 0; i -= (Math.PI / 45)) {
			roundPointsArray.push(ymaps.coordSystem.geo.solveDirectProblem(centerPoint, [Math.cos(i), Math.sin(i)], directionStart).endPoint);
		}
		for (let i = Math.PI; i > angleEnd; i -= (Math.PI / 45)) {
			roundPointsArray.push(ymaps.coordSystem.geo.solveDirectProblem(centerPoint, [Math.cos(i), Math.sin(i)], directionEnd).endPoint);
		}
	}

	return roundPointsArray;
}*/